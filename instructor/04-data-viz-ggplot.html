<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to R: Data Visualisation with ggplot2</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/lc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/lc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/lc/favicon-16x16.png"><link rel="manifest" href="../favicons/lc/site.webmanifest"><link rel="mask-icon" href="../favicons/lc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav library"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="lc-logo" alt="Library Carpentry" src="../assets/images/library-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>


      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../04-data-viz-ggplot.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav library" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Library Carpentry" src="../assets/images/library-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 71%" class="percentage">
    71%
  </div>
  <div class="progress library">
    <div class="progress-bar library" role="progressbar" style="width: 71%" aria-valuenow="71" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../04-data-viz-ggplot.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-before-we-start.html">1. Before we Start</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-r.html">2. Introduction to R</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting with Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-data-cleaning-and-transformation.html">4. Data cleaning &amp; transformation with dplyr</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Data Visualisation with ggplot2
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#getting-set-up">Getting set up</a></li>
<li><a href="#plotting-with-ggplot2">Plotting with <strong><code>ggplot2</code></strong></a></li>
<li><a href="#ggplot2-versus-ggplot"><code>ggplot2</code> versus <code>ggplot</code></a></li>
<li><a href="#creating-your-first-plot">Creating your first plot</a></li>
<li><a href="#defining-the-geoms">Defining the <code>geoms</code></a></li>
<li><a href="#applying-a-different-geom"><strong>Applying a different geom</strong></a></li>
<li><a href="#univariate-and-bivariate-geoms">Univariate and bivariate geoms</a></li>
<li><a href="#add-a-third-variable">Add a third variable</a></li>
<li><a href="#plotting-time-series-data">Plotting time series data</a></li>
<li><a href="#ggplot2-themes"><strong><code>ggplot2</code></strong> themes</a></li>
<li><a href="#customization">Customization</a></li>
<li><a href="#save-and-export">Save and export</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-data-cleaning-and-transformation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-data-cleaning-and-transformation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data cleaning &amp;
        </a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Data Visualisation with ggplot2</h1>
        <p>Last updated on 2026-01-22 |

        <a href="https://github.com/librarycarpentry/lc-r/edit/main/episodes/04-data-viz-ggplot.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 115 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What are the components of a ggplot?</li>
<li>How do I create scatterplots, boxplots, and barplots?</li>
<li>How can I change the aesthetics (ex. colour, transparency) of my
plot?</li>
<li>How can I create multiple plots at once?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the basic syntax of the <code>ggplot</code>
function.</li>
<li>Produce scatter plots, boxplots, and time series plots using
ggplot.</li>
<li>Set universal plot settings.</li>
<li>Describe what faceting is and apply faceting in ggplot.</li>
<li>Modify the aesthetics of an existing ggplot plot (including axis
labels and color).</li>
<li>Build complex and customized plots from data in a data frame.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="getting-set-up">Getting set up<a class="anchor" aria-label="anchor" href="#getting-set-up"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="set-up-your-directories-and-data"><strong>Set up your directories and data</strong><a class="anchor" aria-label="anchor" href="#set-up-your-directories-and-data"></a></h3>
<p>If you have not already done so, open your R Project file
(<code>library_carpentry.Rproj</code>) created in the
<code>Before We Start</code> lesson. Ensure that you have the following
sub-directories in your Rproj: <code>data\</code>,
<code>data_output\</code> and <code>fig_output\</code>.</p>
<p>Run the following code chunk to create the sub-directories and
download the dataset.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">fs</span><span class="op">)</span>   <span class="co"># https://fs.r-lib.org/.  fs is a cross-platform, uniform interface to file system operations via R. </span></span>
<span><span class="fu">dir_create</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu">dir_create</span><span class="op">(</span><span class="st">"data_output"</span><span class="op">)</span></span>
<span><span class="fu">dir_create</span><span class="op">(</span><span class="st">"fig_output"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/22031487"</span>,</span>
<span>              <span class="st">"data/books.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/22051506"</span>,</span>
<span>              <span class="st">"data_output/books_reformatted.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
<p>Then load the packages required for this lesson.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>  <span class="co"># load the core tidyverse</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ purrr     1.2.0
✔ forcats   1.0.1     ✔ stringr   1.6.0
✔ ggplot2   4.0.1     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span>  <span class="co"># load lubridate</span></span></code></pre>
</div>
<p>The<code>lubridate</code> package is installed with the tidyverse,
but is not one of the core tidyverse packages loaded with
<code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>, so it needs to be explicitly called.
<code>lubridate</code> makes working with dates and times easier in
R.</p>
<p>We also load the <code>books_reformatted</code> data we saved in the
previous lesson. Here, we’ll assign it to <code>books2</code>. You can
create the reformatted data by running the codes from <a href="https://librarycarpentry.github.io/lc-r/03-data-cleaning-and-transformation.html#exporting-data" class="external-link">here</a>
or by loading the saved CSV file from previous episode.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">books2</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_output/books_reformatted.csv"</span><span class="op">)</span>  <span class="co"># load the data and assign it to books</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="plotting-with-ggplot2">Plotting with <strong><code>ggplot2</code></strong>
<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot2"></a></h2>
<hr class="half-width"><p>Base R contains a number of functions for quick data visualization
such as <code>plot()</code> for scatter plots, <code>barplot()</code>,
<code>hist()</code> for histograms, and <code>boxplot()</code>. However,
just as data manipulation is easier with <code>dplyr</code> than Base R,
so data visualization is easier with <code>ggplot2</code> than Base R.
<code>ggplot2</code> is a <a href="https://vita.had.co.nz/papers/layered-grammar.html" class="external-link">“grammar” for
data visualization</a> also created by Hadley Wickham, as an
implementation of Leland Wilkinson’s <a href="https://www.worldcat.org/oclc/934513040" class="external-link">Grammar of
Graphics</a>.</p>
<p><code>ggplot</code> is a plotting package that makes it simple to
create complex plots from data stored in a data frame. It provides a
programmatic interface for specifying what variables to plot, how they
are displayed, and general visual properties. Therefore, we only need
minimal changes if the underlying data change or if we decide to change
from a bar plot to a scatterplot. This helps in creating publication
quality plots with minimal amounts of adjustments and tweaking.</p>
<div id="tips-on-plotting-with-ggplot2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="tips-on-plotting-with-ggplot2" class="callout-inner">
<h3 class="callout-title">Tips on plotting with ggplot2:</h3>
<div class="callout-content">
<p><code>ggplot2</code> functions like data in the ‘long’ format, i.e.,
a column for every dimension, and a row for every observation.
Well-structured data will save you lots of time when making figures with
<code>ggplot2</code></p>
<p>ggplot graphics are built step by step by adding new elements. Adding
layers in this fashion allows for extensive flexibility and
customization of plots.</p>
</div>
</div>
</div>
<p>To build a ggplot, we will use the following basic template that can
be used for different types of plots:</p>
<pre><code>ggplot(data = &lt;DATA&gt;, mapping = aes(&lt;MAPPINGS&gt;)) +  &lt;GEOM_FUNCTION&gt;()</code></pre>
<ul><li>The <code>data</code> argument is used to bind the plot to a
specific data frame in <code>ggplot2</code>.</li>
<li>The <code>mapping</code> argument defines the variables mapped to
various aesthetics of the plot, e.g. the x and y axis.</li>
<li>The <code>geom_function</code> argument defines the type of plot,
e.g. barplot, scatter plot, boxplot.</li>
</ul><p>::::::::::::::::::::::::::::::::::::::::::::; callout</p>
</section><section><h2 class="section-heading" id="ggplot2-versus-ggplot">
<code>ggplot2</code> versus <code>ggplot</code>
<a class="anchor" aria-label="anchor" href="#ggplot2-versus-ggplot"></a></h2>
<hr class="half-width"><p>People are sometimes confused between <code>ggplot2</code> and
<code>ggplot</code>. The former refers to the name of the package, while
the latter refers to the function that you run.</p>
<p>:::::::::::::::::::::::::::::::::::::::::</p>
<p>When you run the <code>ggplot()</code> function, it plots directly to
the Plots tab in the Files, Plots, Packages, and Help pane (lower
right). Alternatively, you can assign a plot to an R object, then call
<code>print()</code>to view the plot in the Files, Plots, Packages, and
Help pane.</p>
</section><section><h2 class="section-heading" id="creating-your-first-plot">Creating your first plot<a class="anchor" aria-label="anchor" href="#creating-your-first-plot"></a></h2>
<hr class="half-width"><p>Let’s create a <code>booksPlot</code> and limit our visualization to
only items in <code>subCollection</code> general collection, juvenile,
and k-12, and filter out items with <code>NA</code> in
<code>call_class</code>. We do this by using the <kbd>|</kbd> key on the
keyboard to specify a boolean OR, and use the <code>!is.na()</code>
function to keep only those items that are NOT <code>NA</code> in the
<code>call_class</code> column.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new data frame</span></span>
<span><span class="va">booksPlot</span> <span class="op">&lt;-</span> <span class="va">books2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">subCollection</span> <span class="op">==</span> <span class="st">"general collection"</span> <span class="op">|</span> </span>
<span>           <span class="va">subCollection</span> <span class="op">==</span> <span class="st">"juvenile"</span> <span class="op">|</span> </span>
<span>           <span class="va">subCollection</span> <span class="op">==</span> <span class="st">"k-12 materials"</span>,</span>
<span>         <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">call_class</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>To start with, we first bind our data to the <code>ggplot()</code>
function using the <code>data</code> argument.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span><span class="op">)</span>  <span class="co"># a blank canvas</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-4-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>After running this code, a blank canvas is being created. Next, we
define a mapping aesthetic with the <code>mapping</code> argument (using
the aesthetic (<code>aes()</code>) function). This defines the variables
to be plotted and specifies how to present them in the graph, e.g. as
x/y positions or characteristics such as size, shape, color, etc.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span><span class="op">)</span><span class="op">)</span> <span class="co"># define the x axis aesthetic</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-5-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we define the x axes, but because we have not yet added any
<code>geoms</code>, we still do not see any data being visualized.</p>
</section><section><h2 class="section-heading" id="defining-the-geoms">Defining the <code>geoms</code>
<a class="anchor" aria-label="anchor" href="#defining-the-geoms"></a></h2>
<hr class="half-width"><p>Data is visualized with different “geometric shapes” such as bars and
lines; what are called <em>geoms</em>. In your console, type
<code>geom_</code> and press the tab key to see the geoms included–there
are over 30. For example:</p>
<ul><li>
<code>geom_point()</code> for scatter plots, dot plots, etc.</li>
<li>
<code>geom_boxplot()</code> for boxplots</li>
<li>
<code>geom_bar()</code> for barplots</li>
<li>
<code>geom_line()</code> for trend lines, time series, etc.</li>
</ul><p>Each geom takes a <code>mapping</code> argument within the
<code>aes()</code> call. This is called the <em>aesthetic mapping
argument</em>. In other words, inside the geom function is an
<code>aes()</code> function, and inside <code>aes()</code> is a mapping
argument specifying how to map the variables inside the visualization.
ggplot then looks for that variable inside the data argument, and plots
it accordingly.</p>
<p>For example, in the below expression, the <code>call_class</code>
variable is being mapped to the <code>x</code> axis in the geometric
shape of a bar. In this example, the y axis (count) is not specified,
nor is it a variable in the original dataset, but is the result of
geom_bar() <em>binning</em> your data inside each call number class and
plotting the bin counts (the number of items falling into each bin).</p>
<p>To add a geom to the plot use the <code>+</code> operator.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a bar geom and set call_class as the x axis</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-6-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can see that there are about 1,500 books in the H class, 1,000
books in the P class, 700 books in the E class, etc. As we shall see,
the number of E and F books are deceptively large, as easy books and
fiction books both begin with E and are thus lumped into that category,
though they are not of the E and F Library of Congress call number
classification.</p>
<div id="ggplot-tips" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="ggplot-tips" class="callout-inner">
<h3 class="callout-title">
<code>ggplot</code> tips</h3>
<div class="callout-content">
<ul><li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add (i.e., these are universal plot
settings). This includes the x- and y-axis mapping you set up in
<code>aes()</code>.</li>
<li>You can also specify mappings for a given geom independently of the
mapping defined globally in the <code>ggplot()</code> function.</li>
<li>The <code>+</code> sign used to add new layers must be placed at the
end of the line containing the <em>previous</em> layer. If, instead, the
<code>+</code> sign is added at the beginning of the line containing the
new layer, <strong><code>ggplot2</code></strong> will not add the new
layer and will return an error message.</li>
</ul></div>
</div>
</div>
<p><br></p>
</section><section><h2 class="section-heading" id="applying-a-different-geom"><strong>Applying a different geom</strong><a class="anchor" aria-label="anchor" href="#applying-a-different-geom"></a></h2>
<hr class="half-width"><p>This same exact data can be visualized in a couple different ways by
replacing the geom_histogram() function with either
<code>geom_density()</code> (adding a logarithmic x scale) or
<code>geom_freqpoly()</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a density plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in scale_x_log10(): log-10 transformation introduced infinite values.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2348 rows containing non-finite outside the scale range
(`stat_density()`).</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-7-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a frequency polygon</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_freqpoly</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in scale_y_log10(): log-10 transformation introduced infinite values.</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-7-2.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="univariate-and-bivariate-geoms">Univariate and bivariate geoms<a class="anchor" aria-label="anchor" href="#univariate-and-bivariate-geoms"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="univariate-geoms"><strong>Univariate geoms</strong><a class="anchor" aria-label="anchor" href="#univariate-geoms"></a></h3>
<p><em>“Univariate”</em> refers to a single variable. A histogram is a
univariate plot: it shows the frequency counts of each value inside a
single variable. Let’s say we want to visualize a frequency distibution
of checkouts in the <code>booksPlot</code> data. In other words, how
many items have 1 checkout? How many have 2 checkouts? And so on.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value `binwidth`.</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-8-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>As we have seen in previous lessons, the overwhelming majority of
books have a small amount of usage, so the plot is heavily skewed. As
anyone who has done collection analysis has encountered, this is a very
common issue. It can be addressed in two ways:</p>
<p>First, add a <code>binwidth</code> argument to <code>aes()</code>. In
a histogram, each bin contains the number of occurrences of items in the
data set that are contained within that bin. As stated in the
documentation for <code>?geom_histogram</code>, “You should always
override this value, exploring multiple widths to find the best to
illustrate the stories in your data.”</p>
<p>Second, change the scales of the <code>y</code> axes by adding
another argument to ggplot:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksPlot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in scale_y_log10(): log-10 transformation introduced infinite values.</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-9-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice the scale y axis now goes from 0-10, 10-100, 100-1000, and
1000-10000. This is called “logarithmic scale” and is based on orders of
magnitude. We can therefore see that over 5,000 books (on the y axis)
have between 0-10 checkouts (on the x axis), 1,000 books have 10-20
checkouts, and further down on the x axis, a handful of books have 60-70
checkouts, and a handful more have around 100 checkouts.</p>
<p>We can check this with <code>table()</code>:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">booksPlot</span><span class="op">$</span><span class="va">tot_chkout</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
   0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15
2348  875  638  464  362  282  199  146  118   97   84   50   41   46   40   33
  16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31
  17   20   26   17   14   12    7   15    7    8    6    6    3    3    2    4
  32   33   34   35   36   38   39   40   41   43   47   61   63   69   79  106
   1    5    4    3    2    2    3    1    1    1    1    1    2    1    1    1
 113
   1 </code></pre>
</div>
<p>ggplot has thus given us an easy way to visualize the distribution of
checkouts. If you test this on your own print and ebook usage data, you
will likely find something similar.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="bivariate-geoms"><strong>Bivariate geoms</strong><a class="anchor" aria-label="anchor" href="#bivariate-geoms"></a></h3>
<p>Bivariate plots visualize two variables. Let’s take a look at some
higher usage items, but first eliminate the <code>NA</code> values and
keep only items with more than 10 checkouts, which we will do with
<code>filter()</code> from the <code>dplyr</code> package and assign it
to <code>booksHighUsage</code>.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter booksPlot to include only items with over 10 checkouts</span></span>
<span><span class="va">booksHighUsage</span> <span class="op">&lt;-</span> <span class="va">booksPlot</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">tot_chkout</span><span class="op">)</span>,</span>
<span>                <span class="va">tot_chkout</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<p>We then visualize checkouts by call number with a scatter plot. There
is still so much skew that I retain the logarithmic scale on the y axis
with <code>scale_y_log10()</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># scatter plot high usage books by call number class</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-12-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Again, notice the scale on the y axis. We can obseve a few items of
interest here: No items in the D, J, M, and Z class have more than 30
checkouts. An item in the E class has the most checkouts with over 100,
but, as noted above, this includes Easy books classified with
<code>E</code>, not just items with Library of Congress <code>E</code>
classification (United States history) an issue we’ll look at further
down.</p>
<p>Just as with univariate plots, we can use different geoms to view
various aspects of the data, which in turn reveal different
patterns.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># boxplot plot high usage books by call number class</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-13-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>By adding points to a boxplot, we can have a better idea of the
number of measurements and of their distribution. Here we set the
boxplot <code>alpha</code> to <code>0</code>, which will make it
see-through. We also add another layer of geom to the plot called
<code>geom_jitter()</code>, which will introduce a little bit of
randomness into the position of our points. We set the
<code>color</code> of these points to <code>"tomato"</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-boxplot-with-points-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice how the boxplot layer is behind the jitter layer? What do you
need to change in the code to put the boxplot in front of the points
such that it’s not hidden?</p>
<div id="plotting-exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="plotting-exercise" class="callout-inner">
<h3 class="callout-title">Plotting Exercise</h3>
<div class="callout-content">
<p>Boxplots are useful summaries, but hide the <em>shape</em> of the
distribution. For example, if the distribution is bimodal, we would not
see it in a boxplot. An alternative to the boxplot is the violin plot,
where the shape (of the density of points) is drawn.</p>
<ul><li>Replace the box plot with a violin plot; see
<code>geom_violin()</code>.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-violin-plot-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<div id="plotting-exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="plotting-exercise" class="callout-inner">
<h3 class="callout-title">Plotting Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<ul><li>Add color to the <code>geom_jitter</code> argument on your boxplot
according to the item <code>subCollection</code>. <em>Hint:</em> If you
get the error <code>object 'subCollection' not found</code> or
<code>invalid color name 'subCollection'</code> then consider
<code>color</code> as an aesthetic mapping.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_violin</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.
Groups with fewer than two datapoints have been dropped.
ℹ Set `drop = FALSE` to consider such groups for position adjustment purposes.</code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-boxplot-exercise-subcollection-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<div id="plotting-exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="plotting-exercise" class="callout-inner">
<h3 class="callout-title">Plotting Exercise<em> (continued)</em>
</h3>
<div class="callout-content">
<p>So far, we’ve looked at the distribution of checkouts within call
number ranges. Try making a new plot to explore the distribution of
checkouts within another variable.</p>
<ul><li>Still using the <code>booksHighUsage</code> data, create a boxplot
for <code>tot_chkout</code> for each <code>subCollection</code>. Overlay
the boxplot layer on a jitter layer to show actual measurements. Keep
the <code>scale_y_log10</code> argument.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">subCollection</span>, y <span class="op">=</span> <span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-14-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="add-a-third-variable">Add a third variable<a class="anchor" aria-label="anchor" href="#add-a-third-variable"></a></h2>
<hr class="half-width"><p>As we saw in that exercise, you can convey even more information in
your visualization by adding a third variable, in addition to the first
two on the x and y scales.</p>
<p>We can use arguments in <code>aes()</code> to map a visual aesthetic
in the plot to a variable in the dataset. Specifically, we will map
<code>color</code> to the <code>subCollection</code> variable. Because
we are now mapping features of the data to a color, instead of setting
one color for all points, the color now needs to be set inside a call to
the <strong><code>aes</code></strong> function.
<strong><code>ggplot2</code></strong> will provide a different color
corresponding to different values in the vector. In other words,
associate the name of the aesthetic (<code>color</code>) to the name of
the variable (<code>subCollection</code>) inside <code>aes()</code>:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span>,</span>
<span>           y <span class="op">=</span> <span class="va">tot_chkout</span>,</span>
<span>           color <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-15-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><code>ggplot()</code> automatically assigns a unique level of the
aesthetic to each unique value of the variable (this is called
<em>scaling</em>). Now we reveal indeed that youth materials make up a
large number of high usage items in both the E and the P class.</p>
<p>Use <code>fill()</code> with <code>geom_bar()</code> to create a
stacked bar plot to visualize frequency. Again, this reinforced the fact
that most of the <code>E</code> and <code>P</code> classification are
youth materials.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-16-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Stacked bar charts are generally more difficult to read than
side-by-side bars. We can separate the portions of the stacked bar that
correspond to each village and put them side-by-side by using the
<code>position</code> argument for <code>geom_bar()</code> and setting
it to “dodge”.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">call_class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-barplot-dodge-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The order of the classification scale is sorted for “library order.”
The audience of library professionals typically prefer an alphabetical
arrangement. However, the x-axis variable is actually categorical.
Categorical data are easier to read when the bars are sorted by
frequency. An easy way to sort by frequency is to use the
<code>fct_infreq()</code> function from the <code>forcats</code>
library.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">call_class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-17-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Another visualization issue is labeling. In many cultures, long
labels are easier to read horizontally. Our goal is to flip the x-axis
and reorient the x-axis labels into a horizontal presentation. To
accomplish this, flip the axis coordinates with the
<code>coord_flip()</code> function. When we flip the axes it’s important
to reverse the sorted categorical order. Do this with
<code>forcats::fct_rev()</code>.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">booksHighUsage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">call_class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-18-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="plotting-time-series-data">Plotting time series data<a class="anchor" aria-label="anchor" href="#plotting-time-series-data"></a></h2>
<hr class="half-width"><p>Let’s calculate number of counts per year for each format for items
published after 1990 and before 2002 in the <code>booksHighUsage</code>
data frame created above.</p>
<p>First, we use the <code>ymd()</code> function from the
<code>lubridate</code> package to convert our publication year into a
<em>POSIXct</em> object. Pass the <code>truncated = 2</code> argument as
a way to indicate that the <code>pubyear</code> column does not contain
month or day. This means <code>1990</code> becomes
<code>1990-01-01</code>. This will allow us to plot the number of books
per year.</p>
<p>We will do this by calling <code>mutate()</code> to create a new
variable <code>pubyear_ymd</code>.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">booksPlot</span> <span class="op">&lt;-</span> <span class="va">booksPlot</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>pubyear_ymd <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="va">pubyear</span>, truncated <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>  <span class="co"># convert pubyear to a Date object with ymd()</span></span>
<span></span>
<span><span class="fu">class</span><span class="op">(</span><span class="va">booksPlot</span><span class="op">$</span><span class="va">pubyear</span><span class="op">)</span>  <span class="co"># integer</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "numeric"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">booksPlot</span><span class="op">$</span><span class="va">pubyear_ymd</span><span class="op">)</span>  <span class="co"># Date</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Date"</code></pre>
</div>
<p>Next, we can use <code>filter</code> to remove the <code>NA</code>
values and get books published between 1990 and 2003. Notice that we use
the <code>&amp;</code> as an AND operator to indicate that the date must
fall between that range. We then need to group the data and count
records within each group.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_counts</span> <span class="op">&lt;-</span> <span class="va">booksPlot</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">pubyear_ymd</span><span class="op">)</span>,</span>
<span>         <span class="va">pubyear_ymd</span> <span class="op">&gt;</span> <span class="st">"1989-01-01"</span> <span class="op">&amp;</span> <span class="va">pubyear_ymd</span> <span class="op">&lt;</span> <span class="st">"2002-01-01"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">pubyear_ymd</span>, <span class="va">subCollection</span><span class="op">)</span></span></code></pre>
</div>
<p>Time series data can be visualized as a line plot with years on the x
axis and counts on the y axis:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-first-time-series-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Unfortunately, this does not work because we plotted data for all the
sub-collections together. We need to tell ggplot to draw a line for each
sub-collection by modifying the aesthetic function to include
<code>group = subCollection</code>:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span>, group <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-21-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We will be able to distinguish sub-collections in the plot if we add
colors (using <code>color</code> also automatically groups the
data):</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-time-series-with-colors-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="faceting">Faceting<a class="anchor" aria-label="anchor" href="#faceting"></a></h3>
<p>Rather than creating a single plot with side-by-side bars for each
sub-collection, we may want to create multiple plots, where each plot
shows the data for a single sub-collection. This would be especially
useful if we had a large number of sub-collections that we had sampled,
as a large number of side-by-side bars will become more difficult to
read.</p>
<p><strong><code>ggplot2</code></strong> has a special technique called
<em>faceting</em> that allows the user to split one plot into multiple
plots based on a factor included in the dataset.</p>
<p>There are two types of <code>facet</code> functions:</p>
<ul><li>
<code>facet_wrap()</code> arranges a one-dimensional sequence of
panels to allow them to cleanly fit on one page.</li>
<li>
<code>facet_grid()</code> allows you to form a matrix of rows and
columns of panels.</li>
</ul><p>Both geometries allow to to specify faceting variables specified
within <code>vars()</code>. For example,
<code>facet_wrap(facets = vars(facet_variable))</code> or
<code>facet_grid(rows = vars(row_variable), cols = vars(col_variable))</code>.</p>
<p>Here we use <code>facet_wrap()</code> to make a time series plot for
each subCollection:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-first-facet-1.png" alt="Three line plots, one each for general collection, juvenile, and K-12 sub-collection materials, showing the relationship of count of books to publication year" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can use <code>facet_wrap()</code> as a way of seeing the
categories within a variables. Look at the number of formats per
sub-collection.</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">books2</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">format</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Library subcollection"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-22-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>While this may not be the most beautiful plot, these kinds of
exercises can be helpful for data exploration. We learn that there are
books in all sub-collections; there are CD-ROMS, serials, images, and
microforms in government documents, and so on. Exploratory plots
visually surface information about your data that are otherwise
difficult to parse. Sometimes they may not meet all the rules for
creating beautiful data, but when you are simply getting to know your
data, that’s OK.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Use the <code>books2</code> data to create a bar plot that depicts
the number of items in each sub-collection, faceted by format. Add the
scale_y_log10() argument to create a logarithmic scale for easier
visibility. Add the following theme argument to tilt the axis text
diagonal:
<code>theme(axis.text.x = element_text(angle = 60, hjust = 1))</code></p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">books2</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">format</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-average-weight-time-series-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ggplot2-themes">
<strong><code>ggplot2</code></strong> themes<a class="anchor" aria-label="anchor" href="#ggplot2-themes"></a></h2>
<hr class="half-width"><p>Usually plots with white background look more readable when printed.
Every single component of a <code>ggplot</code> graph can be customized
using the generic <code>theme()</code> function. However, there are
pre-loaded themes available that change the overall appearance of the
graph without much effort.</p>
<p>For example, we can change our graph to have a simpler white
background using the <code>theme_bw()</code> function:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-23-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In addition to <code>theme_bw()</code>, which changes the plot
background to white, <strong><code>ggplot2</code></strong> comes with
several other themes which can be useful to quickly change the look of
your visualization. The complete list of themes is available at <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>.
<code>theme_minimal()</code> and <code>theme_light()</code> are popular,
and <code>theme_void()</code> can be useful as a starting point to
create a new hand-crafted theme.</p>
<p>The <a href="https://jrnold.github.io/ggthemes/reference/index.html" class="external-link">ggthemes</a>
package provides a wide variety of options. The <a href="https://exts.ggplot2.tidyverse.org/" class="external-link"><strong><code>ggplot2</code></strong>
extensions website</a> provides a list of packages that extend the
capabilities of <strong><code>ggplot2</code></strong>, including
additional themes.</p>
</section><section><h2 class="section-heading" id="customization">Customization<a class="anchor" aria-label="anchor" href="#customization"></a></h2>
<hr class="half-width"><p>Take a look at the <a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a>, and think of ways you could improve your plots.</p>
<p>For example, by default, the axes labels on a plot are determined by
the name of the variable being plotted. We can change names of axes to
something more informative than ‘pubyear_ymd’ and ‘n’ and add a title to
the figure:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add labels</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of High Usage Books per Year of Publication, by Sub-Collection"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of publication"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of books"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-24-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that it is also possible to change the fonts of your plots. If
you are on Windows, you may have to install the <a href="https://github.com/wch/extrafont" class="external-link"><strong><code>extrafont</code></strong>
package</a>, and follow the instructions included in the README for this
package.</p>
<p>You can also assign a <code>theme</code> to an object in your
environment, and pass that theme to your plot. This can be helpful to
keep your <code>ggplot()</code> calls less cluttered. Here we create a
<code>gray_theme</code> :</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create the gray theme</span></span>
<span><span class="va">gray_theme</span> <span class="op">&lt;-</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray20"</span>, size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>                    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pass the gray theme to a plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">gray_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of High Usage Books per Year of Publication, \n by Sub-Collection"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of publication"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of books"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-25-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Use the <code>booksPlot</code> data to create a plot that depicts how
the total number of checkouts changes based on year of publication.</p>
<p>First, create a data frame <code>yearly_checkouts</code> That meets
the following conditions:</p>
<ul><li>
<code>filter()</code> to exclude <code>NA</code> values</li>
<li>
<code>filter()</code> between “1989-01-01” and “2002-01-01”</li>
<li>
<code>group_by()</code> the publication year (make sure to use the
special Date pubyear value we created)</li>
<li>
<code>summarize()</code> to create a new value
<code>checkouts_sum</code> that represents the <code>sum()</code> of
total checkouts per publication year</li>
</ul><p>Then, create a <code>ggplot</code> that visualizes the sum of item
checkouts by year of publication. Add one of the themes listed
above.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_checkouts</span> <span class="op">&lt;-</span> <span class="va">booksPlot</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">pubyear_ymd</span><span class="op">)</span>,</span>
<span>        <span class="va">pubyear_ymd</span> <span class="op">&gt;</span> <span class="st">"1989-01-01"</span> <span class="op">&amp;</span> <span class="va">pubyear_ymd</span> <span class="op">&lt;</span> <span class="st">"2002-01-01"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">group_by</span><span class="op">(</span><span class="va">pubyear_ymd</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">summarize</span><span class="op">(</span>checkouts_sum <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">tot_chkout</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_checkouts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">checkouts_sum</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-data-viz-ggplot-rendered-unnamed-chunk-26-1.png" alt="" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="save-and-export">Save and export<a class="anchor" aria-label="anchor" href="#save-and-export"></a></h2>
<hr class="half-width"><p>After creating your plot, you can save it to a file in your favorite
format. The Export tab in the <strong>Plot</strong> pane in RStudio will
save your plots at low resolution, which will not be accepted by many
journals and will not scale well for posters.</p>
<p>Instead, use the <code>ggsave()</code> function, which allows you
easily change the dimension and resolution of your plot by adjusting the
appropriate arguments (<code>width</code>, <code>height</code> and
<code>dpi</code>). We have been printing our plot output directly to the
console. To use <code>ggsave()</code>, first assign the plot to a
variable in your R environment, such as
<code>yearly_counts_plot</code>.</p>
<p>Make sure you have the <code>fig_output/</code> folder in your
working directory.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_counts_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubyear_ymd</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">subCollection</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">gray_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of High Usage Books per Year of Publication, \n by Sub-Collection"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of publication"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of books"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"fig_output/yearly_counts_plot.png"</span>, <span class="va">yearly_counts_plot</span>, width <span class="op">=</span> <span class="fl">15</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div id="exercise" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>With all of this information in hand, please take another five
minutes to either improve one of the plots generated in this exercise or
create a beautiful graph of your own. Use the RStudio <a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a> for inspiration. Here are some ideas:</p>
<ul><li>See if you can make the bars white with black outline.</li>
<li>Try using a different color palette (see <a href="https://www.cookbook-r.com/Graphs/Colors_(ggplot2)/" class="external-link">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/</a>).</li>
</ul></div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>
<code>ggplot2</code> is a flexible and useful tool for creating
plots in R.</li>
<li>The data set and coordinate system can be defined using the
<code>ggplot</code> function.</li>
<li>Additional layers, including geoms, are added using the
<code>+</code> operator.</li>
<li>Boxplots are useful for visualizing the distribution of a continuous
variable.</li>
<li>Barplot are useful for visualizing categorical data.</li>
<li>Faceting allows you to generate multiple plots based on a
categorical variable.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-data-cleaning-and-transformation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-data-cleaning-and-transformation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data cleaning &amp;
        </a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/librarycarpentry/lc-r/edit/main/episodes/04-data-viz-ggplot.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/librarycarpentry/lc-r/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/librarycarpentry/lc-r/" class="external-link">Source</a></p>
        <p>
        <a href="https://github.com/librarycarpentry/lc-r/blob/main/" class="external-link">Cite</a>
        | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
		</div>
		<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.18.3" class="external-link">sandpaper (0.18.3)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.9" class="external-link">varnish (1.0.9)</a></p>
		</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://librarycarpentry.github.io/lc-r/instructor/04-data-viz-ggplot.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Data Visualisation with ggplot2",
  "creativeWorkStatus": "active",
  "url": "https://librarycarpentry.github.io/lc-r/instructor/04-data-viz-ggplot.html",
  "identifier": "https://librarycarpentry.github.io/lc-r/instructor/04-data-viz-ggplot.html",
  "dateCreated": "2019-05-30",
  "dateModified": "2026-01-22",
  "datePublished": "2026-01-22"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

